As far as the query shit  i have no idea if solrdispatchfilter or whatever could/should do Thread.currentThread.setNamex or whatever and maybe restore after.     