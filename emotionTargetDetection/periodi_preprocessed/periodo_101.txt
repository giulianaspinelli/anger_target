as far as the query shit  i have no idea if solrdispatchfilter or whatever could/should do thread.currentthread.setnamex or whatever and maybe restore after.     